
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialConnect - Community Help Network</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4285F4;
            --primary-dark: #3367D6;
            --secondary: #34A853;
            --accent: #EA4335;
            --warning: #FBBC05;
            --light: #F8F9FA;
            --dark: #202124;
            --gray: #5F6368;
            --light-gray: #E8EAED;
            --card-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }
        
        /* Header Styles */
        header {
            background-color: white;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0.8rem 1.5rem;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        
        .logo i {
            margin-right: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            align-items: center;
        }
        
        .nav-links a {
            margin-left: 1.5rem;
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a.active {
            color: var(--primary);
            font-weight: 600;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--accent);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .user-profile {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        
        .user-profile img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            width: 220px;
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        
        .profile-dropdown.active {
            display: block;
        }
        
        .dropdown-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .dropdown-header .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 0.8rem;
        }
        
        .dropdown-header .user-info {
            flex: 1;
        }
        
        .dropdown-header .user-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }
        
        .dropdown-header .user-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .dropdown-item {
            padding: 0.8rem 1rem;
            display: flex;
            align-items: center;
            color: var(--dark);
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: var(--light);
        }
        
        .dropdown-item i {
            width: 24px;
            margin-right: 0.8rem;
            color: var(--gray);
        }
        
        .dropdown-divider {
            height: 1px;
            background-color: var(--light-gray);
            margin: 0.2rem 0;
        }
        
        /* Main Content Layout */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        @media (min-width: 992px) {
            .container {
                grid-template-columns: 300px 1fr;
            }
        }
        
        /* Sidebar Styles */
        .sidebar {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 1.5rem;
            height: fit-content;
        }
        
        .user-card {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light-gray);
            margin-right: 1rem;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }
        
        .user-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .reputation {
            display: flex;
            align-items: center;
            margin-top: 0.3rem;
        }
        
        .reputation i {
            color: var(--warning);
            margin-right: 0.3rem;
        }
        
        .mode-toggle {
            margin-bottom: 1.5rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--light-gray);
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .toggle-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .active-label {
            color: var(--primary);
        }
        
        .filter-section {
            margin-bottom: 1.5rem;
        }
        
        .filter-section h4 {
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }
        
        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            background-color: var(--light-gray);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tag:hover {
            background-color: #d3d3d3;
        }
        
        .tag.active {
            background-color: var(--primary);
            color: white;
        }
        
        .skill-item, .need-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: #f0f4ff;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .skill-actions, .need-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .edit-btn, .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 0.8rem;
        }
        
        .edit-btn:hover {
            color: var(--primary);
        }
        
        .delete-btn:hover {
            color: var(--accent);
        }
        
        .location-filter {
            margin-top: 1rem;
        }
        
        .location-filter select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-family: inherit;
        }
        
        /* Main Content Styles */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .create-post {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 1.5rem;
        }
        
        .create-post h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .post-form textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            resize: none;
            margin-bottom: 1rem;
            font-family: inherit;
            min-height: 100px;
        }
        
        .post-form textarea::placeholder {
            color: var(--gray);
        }
        
        .post-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-select {
            flex-grow: 1;
            margin-right: 1rem;
        }
        
        .category-select select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-family: inherit;
        }
        
        .post-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .post-button:hover {
            background-color: var(--primary-dark);
        }
        
        /* Posts Feed */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .post-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 1.5rem;
            position: relative;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray);
            margin-right: 1rem;
            overflow: hidden;
        }
        
        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .post-user {
            flex-grow: 1;
        }
        
        .post-user h4 {
            font-size: 1rem;
        }
        
        .post-user p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .post-distance {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
        }
        
        .post-distance i {
            margin-right: 0.3rem;
        }
        
        .post-content {
            margin-bottom: 1rem;
        }
        
        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .post-tag {
            background-color: var(--light);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--light-gray);
            padding-top: 1rem;
        }
        
        .action-button {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .action-button i {
            margin-right: 0.5rem;
        }
        
        .action-button:hover {
            color: var(--primary);
        }
        
        .help-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .help-button:hover {
            background-color: #2d9241;
        }
        
        .post-edit-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .edit-post-btn {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .delete-post-btn {
            background-color: var(--accent);
            color: white;
        }
        
        /* Chat Button */
        .chat-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 90;
        }
        
        .chat-button i {
            font-size: 1.5rem;
        }
        
        .chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            padding: 0.8rem 0;
            z-index: 95;
        }
        
        .mobile-menu-items {
            display: flex;
            justify-content: space-around;
        }
        
        .mobile-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray);
            text-decoration: none;
            font-size: 0.8rem;
            position: relative;
        }
        
        .mobile-menu-item i {
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }
        
        .mobile-menu-item.active {
            color: var(--primary);
        }
        
        .mobile-badge {
            position: absolute;
            top: -5px;
            right: 8px;
            background-color: var(--accent);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .mobile-menu {
                display: block;
            }
            
            .sidebar {
                display: none;
            }
            
            .container {
                grid-template-columns: 1fr;
                margin-bottom: 70px;
            }
        }
        
        /* Accessibility Features */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #e0e0e0;
            }
            
            header, .sidebar, .create-post, .post-card, 
            .profile-dropdown {
                background-color: #1e1e1e;
                box-shadow: 0 1px 3px rgba(0,0,0,0.5);
            }
            
            .tag, .post-tag {
                background-color: #2d2d2d;
                color: #e0e0e0;
            }
            
            .tag:hover {
                background-color: #3d3d3d;
            }
            
            .tag.active {
                background-color: var(--primary);
            }
            
            .post-form textarea, .category-select select, .location-filter select {
                background-color: #2d2d2d;
                border-color: #3d3d3d;
                color: #e0e0e0;
            }
            
            .light-gray {
                border-color: #3d3d3d;
            }
            
            .skill-item, .need-item {
                background: #2a2a4a;
            }
            
            .dropdown-item:hover {
                background-color: #2d2d2d;
            }
        }
        
        /* Connection Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-header h3 {
            font-size: 1.3rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .connection-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .connection-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
        }
        
        .connection-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 1rem;
        }
        
        .connection-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .connection-details {
            flex: 1;
        }
        
        .connection-details h4 {
            margin-bottom: 0.3rem;
        }
        
        .connection-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
        }
        
        .stat-item i {
            margin-right: 0.3rem;
            color: var(--primary);
        }
        
        .location-map {
            height: 150px;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin: 1rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--gray);
        }
        
        .connection-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .action-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .action-btn i {
            margin-right: 0.5rem;
        }
        
        .message-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .call-btn {
            background-color: var(--secondary);
            color: white;
        }
        
        /* AI Suggestion */
        .ai-suggestion {
            background-color: #e8f5e9;
            border-left: 4px solid var(--secondary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1.5rem;
        }
        
        .ai-suggestion h4 {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .ai-suggestion h4 i {
            margin-right: 0.5rem;
        }
        
        /* Distance indicator */
        .distance-indicator {
            height: 10px;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--warning) 50%, var(--accent) 100%);
            border-radius: 5px;
            margin: 1rem 0;
            position: relative;
        }
        
        .distance-marker {
            position: absolute;
            top: -5px;
            width: 20px;
            height: 20px;
            background-color: var(--primary);
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .distance-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Profile Management */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .profile-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .profile-form {
            display: grid;
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input, 
        .form-group textarea,
        .form-group select {
            padding: 0.75rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .save-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .cancel-btn {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        /* Add Skill/Need Modal */
        .skill-modal {
            display: none;
        }

        /* Status message */
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header>
        <nav class="navbar">
            <a href="#" class="logo">
                <i class="fas fa-hands-helping"></i>
                <span>SocialConnect</span>
            </a>
            
            <div class="nav-links">
                <a href="#" class="active">Home</a>
                <a href="#" id="messagesLink">Messages <span class="notification-badge">5</span></a>
                <a href="#" id="requestsLink">My Requests</a>
                <a href="#" id="offersLink">My Offers</a>
                <a href="#" id="notificationsLink">Notifications <span class="notification-badge">3</span></a>
                <div class="user-profile" id="profileBtn">
                    <img id="userProfileImage" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="User profile">
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-header">
                            <div class="user-avatar">
                                <img id="dropdownProfileImage" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="User avatar">
                            </div>
                            <div class="user-info">
                                <h4 id="dropdownUserName">Guest User</h4>
                                <p id="dropdownUserEmail">guest@example.com</p>
                            </div>
                        </div>
                        <a href="#" class="dropdown-item" id="editProfileBtn">
                            <i class="fas fa-user-edit"></i>
                            <span>Edit Profile</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="user-card">
                <div class="user-avatar">
                    <img id="sidebarUserImage" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="User avatar">
                </div>
                <div class="user-info">
                    <h3 id="sidebarUserName">Guest User</h3>
                    <p id="sidebarUserStatus">Offering Help</p>
                    <div class="reputation">
                        <i class="fas fa-star"></i>
                        <span>4.8 (24)</span>
                    </div>
                </div>
            </div>
            
            <div class="mode-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="modeToggle" checked>
                    <span class="slider"></span>
                </label>
                <div class="toggle-labels">
                    <span>Seek Help</span>
                    <span class="active-label">Offer Help</span>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>Filter by Category</h4>
                <div class="category-tags">
                    <div class="tag active">All</div>
                    <div class="tag">Emotional Support</div>
                    <div class="tag">Technical Help</div>
                    <div class="tag">Physical Aid</div>
                    <div class="tag">Daily Tasks</div>
                    <div class="tag">Education</div>
                    <div class="tag">Health</div>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>Filter by Location</h4>
                <div class="location-filter">
                    <select>
                        <option>Within 1 mile</option>
                        <option selected>Within 5 miles</option>
                        <option>Within 10 miles</option>
                        <option>Within 25 miles</option>
                        <option>Any distance</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>My Skills <button class="add-btn" id="addSkillBtn" style="float:right; background:none; border:none; cursor:pointer;"><i class="fas fa-plus"></i></button></h4>
                <div id="skillsList">
                    <!-- Skills will be populated here -->
                </div>
            </div>
            
            <div class="filter-section">
                <h4>My Needs <button class="add-btn" id="addNeedBtn" style="float:right; background:none; border:none; cursor:pointer;"><i class="fas fa-plus"></i></button></h4>
                <div id="needsList">
                    <!-- Needs will be populated here -->
                </div>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Create Post -->
            <section class="create-post">
                <h2 id="postTitle">Create a Help Offer</h2>
                <div id="postStatusMessage" class="status-message" style="display: none;"></div>
                <form class="post-form" id="postForm">
                    <textarea placeholder="What kind of help can you offer? Be specific about your skills and availability..." id="postContent"></textarea>
                    <div class="post-options">
                        <div class="category-select">
                            <select id="postCategory">
                                <option>Select a category</option>
                                <option>Emotional Support</option>
                                <option>Technical Help</option>
                                <option>Physical Aid</option>
                                <option>Daily Tasks</option>
                                <option>Education</option>
                                <option>Health</option>
                            </select>
                        </div>
                        <button type="submit" class="post-button">Post Offer</button>
                    </div>
                </form>
            </section>
            
            <!-- Posts Feed -->
            <section class="posts-feed">
                <h2>Help Requests Near You</h2>
                <div id="loadingPosts" class="spinner" style="display: none;"></div>
                <div id="postsContainer">
                    <!-- Posts will be populated here -->
                </div>
            </section>
        </main>
    </div>
    
    <!-- Chat Button -->
    <div class="chat-button" aria-label="Open chat">
        <i class="fas fa-comment-dots"></i>
        <div class="chat-badge">3</div>
    </div>
    
    <!-- Mobile Menu -->
    <nav class="mobile-menu">
        <div class="mobile-menu-items">
            <a href="#" class="mobile-menu-item active">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-comments"></i>
                <span>Messages <span class="mobile-badge">5</span></span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-bell"></i>
                <span>Notifications <span class="mobile-badge">3</span></span>
            </a>
            <a href="#" class="mobile-menu-item" id="mobileProfileBtn">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </nav>
    
    <!-- Connection Modal -->
    <div class="modal" id="connectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-handshake"></i> Connection Made!</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="connection-info">
                <div class="connection-card">
                    <div class="connection-avatar">
                        <img id="currentUserAvatar" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="Your profile">
                    </div>
                    <div class="connection-details">
                        <h4 id="currentUserName">You</h4>
                        <p id="currentUserSkills">Offering help</p>
                        <div class="connection-stats">
                            <div class="stat-item">
                                <i class="fas fa-star"></i>
                                <span>4.8 (24 reviews)</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Online Now</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="connection-card">
                    <div class="connection-avatar">
                        <img id="connectionUserAvatar" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="Connection profile">
                    </div>
                    <div class="connection-details">
                        <h4 id="connectionUserName">Connection Name</h4>
                        <p id="connectionUserNeeds">Seeking help</p>
                        <div class="connection-stats">
                            <div class="stat-item">
                                <i class="fas fa-star"></i>
                                <span>4.5 (18 reviews)</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>1.2 miles away</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="location-map">
                    <i class="fas fa-map-marked-alt fa-2x"></i>
                    <span>Interactive Map Showing Both Locations</span>
                </div>
                
                <div class="distance-indicator">
                    <div class="distance-marker" style="left: 20%;"></div>
                </div>
                <div class="distance-labels">
                    <span>You</span>
                    <span>1.2 miles</span>
                    <span>Connection</span>
                </div>
                
                <div class="ai-suggestion">
                    <h4><i class="fas fa-robot"></i> AI Suggestion</h4>
                    <p>Based on both your profiles and proximity, we suggest meeting at Central Cafe for coffee. 
                       This neutral location is halfway between you both and known for its quiet atmosphere, 
                       perfect for conversation. Available times: Tomorrow 2-4 PM or Friday 10 AM-12 PM.</p>
                </div>
                
                <div class="connection-actions">
                    <button class="action-btn message-btn">
                        <i class="fas fa-comment"></i>
                        <span>Send Message</span>
                    </button>
                    <button class="action-btn call-btn">
                        <i class="fas fa-phone-alt"></i>
                        <span>Voice Call</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Management Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Edit Your Profile</h3>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            
            <form class="profile-form" id="profileForm">
                <div class="form-group">
                    <label for="profileName">Full Name</label>
                    <input type="text" id="profileName" placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <textarea id="profileBio" placeholder="Tell others about yourself"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="profileLocation">Location</label>
                    <input type="text" id="profileLocation" placeholder="Enter your location">
                </div>
                
                <div class="form-group">
                    <label for="profileStatus">Current Status</label>
                    <select id="profileStatus">
                        <option value="offering">Offering Help</option>
                        <option value="seeking">Seeking Help</option>
                        <option value="both">Both Offering and Seeking</option>
                    </select>
                </div>
                
                <div id="profileStatusMessage" class="status-message" style="display: none;"></div>
                
                <div class="form-actions">
                    <button type="button" class="post-button cancel-btn" onclick="closeProfileModal()">Cancel</button>
                    <button type="submit" class="post-button save-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div class="modal" id="addSkillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Add New Skill</h3>
                <button class="close-btn" onclick="closeSkillModal()">&times;</button>
            </div>
            
            <form id="skillForm">
                <div class="form-group">
                    <label for="skillName">Skill Name</label>
                    <input type="text" id="skillName" placeholder="Enter skill (e.g. Cooking, Tutoring)">
                </div>
                
                <div class="form-group">
                    <label for="skillLevel">Proficiency Level</label>
                    <select id="skillLevel">
                        <option>Beginner</option>
                        <option>Intermediate</option>
                        <option>Advanced</option>
                        <option>Expert</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="skillDesc">Description (Optional)</label>
                    <textarea id="skillDesc" placeholder="Describe your experience with this skill"></textarea>
                </div>
                
                <div id="skillStatusMessage" class="status-message" style="display: none;"></div>
                
                <div class="form-actions">
                    <button type="button" class="post-button cancel-btn" onclick="closeSkillModal()">Cancel</button>
                    <button type="submit" class="post-button save-btn">Add Skill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Need Modal -->
    <div class="modal" id="addNeedModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Add New Need</h3>
                <button class="close-btn" onclick="closeNeedModal()">&times;</button>
            </div>
            
            <form id="needForm">
                <div class="form-group">
                    <label for="needName">Need Name</label>
                    <input type="text" id="needName" placeholder="Enter need (e.g. Home Repair, Childcare)">
                </div>
                
                <div class="form-group">
                    <label for="needFrequency">Frequency</label>
                    <select id="needFrequency">
                        <option>One-time</option>
                        <option>Weekly</option>
                        <option>Bi-weekly</option>
                        <option>Monthly</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="needDesc">Description</label>
                    <textarea id="needDesc" placeholder="Describe what you need help with"></textarea>
                </div>
                
                <div id="needStatusMessage" class="status-message" style="display: none;"></div>
                
                <div class="form-actions">
                    <button type="button" class="post-button cancel-btn" onclick="closeNeedModal()">Cancel</button>
                    <button type="submit" class="post-button save-btn">Add Need</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAAxl0xBc_nLkTRO3XwiedbBD7Vj417i5M",
            authDomain: "smart-personal-helper.firebaseapp.com",
            projectId: "smart-personal-helper",
            storageBucket: "smart-personal-helper.appspot.com",
            messagingSenderId: "63071338320",
            appId: "1:63071338320:web:87851a90236a7df7ff3655",
            measurementId: "G-MP9GQJYTQC"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // DOM Elements
        const modeToggle = document.getElementById('modeToggle');
        const postForm = document.getElementById('postForm');
        const postTitle = document.getElementById('postTitle');
        const postContent = document.getElementById('postContent');
        const postCategory = document.getElementById('postCategory');
        const postStatusMessage = document.getElementById('postStatusMessage');
        const profileBtn = document.getElementById('profileBtn');
        const profileDropdown = document.getElementById('profileDropdown');
        const mobileProfileBtn = document.getElementById('mobileProfileBtn');
        const profileForm = document.getElementById('profileForm');
        const addSkillBtn = document.getElementById('addSkillBtn');
        const addSkillModal = document.getElementById('addSkillModal');
        const skillForm = document.getElementById('skillForm');
        const skillsList = document.getElementById('skillsList');
        const addNeedBtn = document.getElementById('addNeedBtn');
        const addNeedModal = document.getElementById('addNeedModal');
        const needForm = document.getElementById('needForm');
        const needsList = document.getElementById('needsList');
        const logoutBtn = document.getElementById('logoutBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const connectionModal = document.getElementById('connectionModal');
        const profileModal = document.getElementById('profileModal');
        const postsContainer = document.getElementById('postsContainer');
        const loadingPosts = document.getElementById('loadingPosts');
        const currentUserAvatar = document.getElementById('currentUserAvatar');
        const currentUserName = document.getElementById('currentUserName');
        const currentUserSkills = document.getElementById('currentUserSkills');
        const connectionUserAvatar = document.getElementById('connectionUserAvatar');
        const connectionUserName = document.getElementById('connectionUserName');
        const connectionUserNeeds = document.getElementById('connectionUserNeeds');
        const sidebarUserImage = document.getElementById('sidebarUserImage');
        const sidebarUserName = document.getElementById('sidebarUserName');
        const sidebarUserStatus = document.getElementById('sidebarUserStatus');
        const dropdownProfileImage = document.getElementById('dropdownProfileImage');
        const dropdownUserName = document.getElementById('dropdownUserName');
        const dropdownUserEmail = document.getElementById('dropdownUserEmail');
        const userProfileImage = document.getElementById('userProfileImage');
        const profileStatusMessage = document.getElementById('profileStatusMessage');
        
        // Current user data
        let currentUser = null;
        let userProfile = {};
        let userSkills = [];
        let userNeeds = [];
        let posts = [];
        
        // Initialize application
        function initApp() {
            // Set up event listeners
            modeToggle.addEventListener('change', toggleHelpMode);
            postForm.addEventListener('submit', handlePostSubmit);
            profileBtn.addEventListener('click', toggleProfileDropdown);
            mobileProfileBtn.addEventListener('click', openProfileModal);
            profileForm.addEventListener('submit', saveProfile);
            addSkillBtn.addEventListener('click', openSkillModal);
            skillForm.addEventListener('submit', addNewSkill);
            addNeedBtn.addEventListener('click', openNeedModal);
            needForm.addEventListener('submit', addNewNeed);
            logoutBtn.addEventListener('click', logout);
            editProfileBtn.addEventListener('click', openProfileModal);
            
            // Initialize Firebase auth state listener
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserProfile();
                    loadPosts();
                } else {
                    // Simulate a guest user
                    currentUser = {
                        uid: 'guest',
                        displayName: 'Guest User',
                        email: 'guest@example.com',
                        photoURL: 'https://randomuser.me/api/portraits/lego/1.jpg'
                    };
                    updateUserUI();
                }
            });
        }
        
        // Load user profile from Firestore
        async function loadUserProfile() {
            if (!currentUser || currentUser.uid === 'guest') return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userProfile = userDoc.data();
                    userSkills = userProfile.skills || [];
                    userNeeds = userProfile.needs || [];
                    
                    updateUserUI();
                    renderSkills();
                    renderNeeds();
                } else {
                    // Create new profile if doesn't exist
                    userProfile = {
                        name: currentUser.displayName || 'New User',
                        email: currentUser.email,
                        status: 'offering',
                        skills: [],
                        needs: [],
                        bio: '',
                        location: ''
                    };
                    await db.collection('users').doc(currentUser.uid).set(userProfile);
                    updateUserUI();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                showStatusMessage(profileStatusMessage, 'Error loading profile. Please try again.', 'error');
            }
        }
        
        // Update UI with user data
        function updateUserUI() {
            if (!currentUser) return;
            
            // Update profile images
            const avatarUrl = currentUser.photoURL || 'https://randomuser.me/api/portraits/lego/1.jpg';
            sidebarUserImage.src = avatarUrl;
            dropdownProfileImage.src = avatarUrl;
            userProfileImage.src = avatarUrl;
            currentUserAvatar.src = avatarUrl;
            
            // Update names
            const userName = userProfile.name || currentUser.displayName || 'User';
            sidebarUserName.textContent = userName;
            dropdownUserName.textContent = userName;
            currentUserName.textContent = userName + ' (You)';
            
            // Update status
            const statusText = userProfile.status === 'offering' ? 'Offering Help' : 
                              userProfile.status === 'seeking' ? 'Seeking Help' : 
                              'Both Offering and Seeking';
            sidebarUserStatus.textContent = statusText;
            
            // Update email
            dropdownUserEmail.textContent = currentUser.email || 'user@example.com';
            
            // Update skills/needs
            currentUserSkills.textContent = userProfile.skills ? 
                'Offering: ' + userProfile.skills.slice(0, 3).join(', ') : 
                'Offering help';
        }
        
        // Toggle between seek help and offer help modes
        function toggleHelpMode(e) {
            const labels = document.querySelectorAll('.toggle-labels span');
            if (e.target.checked) {
                labels[0].classList.remove('active-label');
                labels[1].classList.add('active-label');
                postTitle.textContent = 'Create a Help Offer';
                postContent.placeholder = 'What kind of help can you offer? Be specific about your skills and availability...';
            } else {
                labels[0].classList.add('active-label');
                labels[1].classList.remove('active-label');
                postTitle.textContent = 'Create a Help Request';
                postContent.placeholder = 'What kind of help do you need? Be specific about your needs and timeframe...';
            }
        }
        
        // Handle post submission
        async function handlePostSubmit(e) {
            e.preventDefault();
            const content = postContent.value.trim();
            const category = postCategory.value;
            
            if (!content || category === 'Select a category') {
                showStatusMessage(postStatusMessage, 'Please fill all fields', 'error');
                return;
            }
            
            if (!currentUser || currentUser.uid === 'guest') {
                showStatusMessage(postStatusMessage, 'Please sign in to create posts', 'error');
                return;
            }
            
            try {
                const isOfferingHelp = modeToggle.checked;
                const postData = {
                    userId: currentUser.uid,
                    userName: userProfile.name || currentUser.displayName,
                    userAvatar: currentUser.photoURL || 'https://randomuser.me/api/portraits/lego/1.jpg',
                    content,
                    category,
                    isHelpOffer: isOfferingHelp,
                    isHelpRequest: !isOfferingHelp,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active'
                };
                
                await db.collection('posts').add(postData);
                showStatusMessage(postStatusMessage, 'Post created successfully!', 'success');
                postForm.reset();
            } catch (error) {
                console.error('Error creating post:', error);
                showStatusMessage(postStatusMessage, 'Failed to create post. Please try again.', 'error');
            }
        }
        
        // Load posts from Firestore
        async function loadPosts() {
            if (!currentUser) return;
            
            try {
                loadingPosts.style.display = 'block';
                postsContainer.innerHTML = '';
                
                const postsSnapshot = await db.collection('posts')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                posts = [];
                postsSnapshot.forEach(doc => {
                    posts.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderPosts();
                loadingPosts.style.display = 'none';
            } catch (error) {
                console.error('Error loading posts:', error);
                loadingPosts.style.display = 'none';
                postsContainer.innerHTML = '<p>Error loading posts. Please try again later.</p>';
            }
        }
        
        // Render posts to the UI
        function renderPosts() {
            postsContainer.innerHTML = '';
            
            if (posts.length === 0) {
                postsContainer.innerHTML = '<p>No posts found. Be the first to create one!</p>';
                return;
            }
            
            posts.forEach(post => {
                const postElement = document.createElement('article');
                postElement.className = 'post-card';
                postElement.id = `post-${post.id}`;
                postElement.dataset.userId = post.userId;
                
                const timeAgo = post.createdAt ? getTimeAgo(post.createdAt.toDate()) : 'Just now';
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-avatar">
                            <img src="${post.userAvatar}" alt="User avatar">
                        </div>
                        <div class="post-user">
                            <h4>${post.userName}</h4>
                            <p>${post.isHelpRequest ? 'Seeking Help' : 'Offering Help'}  ${timeAgo}</p>
                        </div>
                        <div class="post-distance">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${(Math.random() * 5).toFixed(1)} miles away</span>
                        </div>
                    </div>
                    
                    <div class="post-content">
                        <p>${post.content}</p>
                    </div>
                    
                    <div class="post-tags">
                        <div class="post-tag">${post.category}</div>
                        <div class="post-tag">${post.isHelpRequest ? 'Help Requested' : 'Help Offered'}</div>
                    </div>
                    
                    <div class="post-actions">
                        <button class="action-button">
                            <i class="far fa-comment"></i>
                            <span>${Math.floor(Math.random() * 10)} Comments</span>
                        </button>
                        <button class="help-button" onclick="showConnectionModal('${post.userId}')">
                            ${post.isHelpRequest ? 'Offer Help' : 'Request Help'}
                        </button>
                    </div>
                `;
                
                // Add edit/delete buttons for current user's posts
                if (currentUser && post.userId === currentUser.uid) {
                    const editActions = document.createElement('div');
                    editActions.className = 'post-edit-actions';
                    editActions.innerHTML = `
                        <button class="post-button edit-post-btn" onclick="editPost('${post.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="post-button delete-post-btn" onclick="deletePost('${post.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    `;
                    postElement.appendChild(editActions);
                }
                
                postsContainer.appendChild(postElement);
            });
        }
        
        // Show connection modal
        async function showConnectionModal(userId) {
            // For demo, we'll simulate connection data
            const connectionUser = {
                name: userId === 'guest' ? 'Guest User' : 'Michael Chen',
                avatar: 'https://randomuser.me/api/portraits/men/32.jpg',
                needs: 'Emotional Support, Conversation',
                skills: 'Counseling, Listening'
            };
            
            connectionUserAvatar.src = connectionUser.avatar;
            connectionUserName.textContent = connectionUser.name;
            connectionUserNeeds.textContent = `Seeking: ${connectionUser.needs}`;
            
            connectionModal.style.display = 'flex';
        }
        
        // Close modal
        function closeModal() {
            connectionModal.style.display = 'none';
        }
        
        // Toggle profile dropdown
        function toggleProfileDropdown(e) {
            e.stopPropagation();
            profileDropdown.classList.toggle('active');
        }
        
        // Open profile modal
        function openProfileModal(e) {
            if (e) e.preventDefault();
            if (!currentUser || currentUser.uid === 'guest') {
                alert('Please sign in to edit your profile');
                return;
            }
            
            document.getElementById('profileName').value = userProfile.name || '';
            document.getElementById('profileBio').value = userProfile.bio || '';
            document.getElementById('profileLocation').value = userProfile.location || '';
            document.getElementById('profileStatus').value = userProfile.status || 'offering';
            
            profileModal.style.display = 'flex';
        }
        
        // Close profile modal
        function closeProfileModal() {
            profileModal.style.display = 'none';
        }
        
        // Save profile
        async function saveProfile(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.uid === 'guest') {
                showStatusMessage(profileStatusMessage, 'Please sign in to save your profile', 'error');
                return;
            }
            
            try {
                userProfile.name = document.getElementById('profileName').value;
                userProfile.bio = document.getElementById('profileBio').value;
                userProfile.location = document.getElementById('profileLocation').value;
                userProfile.status = document.getElementById('profileStatus').value;
                
                await db.collection('users').doc(currentUser.uid).set(userProfile, { merge: true });
                showStatusMessage(profileStatusMessage, 'Profile updated successfully!', 'success');
                updateUserUI();
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    closeProfileModal();
                }, 2000);
            } catch (error) {
                console.error('Error saving profile:', error);
                showStatusMessage(profileStatusMessage, 'Failed to save profile. Please try again.', 'error');
            }
        }
        
        // Open skill modal
        function openSkillModal() {
            if (!currentUser || currentUser.uid === 'guest') {
                alert('Please sign in to add skills');
                return;
            }
            addSkillModal.style.display = 'flex';
        }
        
        // Close skill modal
        function closeSkillModal() {
            addSkillModal.style.display = 'none';
            skillForm.reset();
            document.getElementById('skillStatusMessage').style.display = 'none';
        }
        
        // Add new skill
        async function addNewSkill(e) {
            e.preventDefault();
            const skillName = document.getElementById('skillName').value;
            
            if (!skillName) {
                showStatusMessage('skillStatusMessage', 'Please enter a skill name', 'error');
                return;
            }
            
            try {
                const newSkill = {
                    name: skillName,
                    level: document.getElementById('skillLevel').value,
                    description: document.getElementById('skillDesc').value
                };
                
                userSkills.push(newSkill);
                await db.collection('users').doc(currentUser.uid).update({
                    skills: firebase.firestore.FieldValue.arrayUnion(newSkill)
                });
                
                renderSkills();
                showStatusMessage('skillStatusMessage', 'Skill added successfully!', 'success');
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    closeSkillModal();
                }, 2000);
            } catch (error) {
                console.error('Error adding skill:', error);
                showStatusMessage('skillStatusMessage', 'Failed to add skill. Please try again.', 'error');
            }
        }
        
        // Render skills to UI
        function renderSkills() {
            skillsList.innerHTML = '';
            
            if (userSkills.length === 0) {
                skillsList.innerHTML = '<p>No skills added yet</p>';
                return;
            }
            
            userSkills.forEach((skill, index) => {
                const skillItem = document.createElement('div');
                skillItem.className = 'skill-item';
                skillItem.innerHTML = `
                    <span>${skill.name} (${skill.level})</span>
                    <div class="skill-actions">
                        <button class="edit-btn" onclick="editSkill(${index})"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteSkill(${index})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                skillsList.appendChild(skillItem);
            });
        }
        
        // Delete skill
        async function deleteSkill(index) {
            if (!currentUser || currentUser.uid === 'guest') return;
            
            if (confirm('Are you sure you want to delete this skill?')) {
                try {
                    const skillToDelete = userSkills[index];
                    userSkills.splice(index, 1);
                    
                    await db.collection('users').doc(currentUser.uid).update({
                        skills: firebase.firestore.FieldValue.arrayRemove(skillToDelete)
                    });
                    
                    renderSkills();
                } catch (error) {
                    console.error('Error deleting skill:', error);
                    alert('Failed to delete skill. Please try again.');
                }
            }
        }
        
        // Open need modal
        function openNeedModal() {
            if (!currentUser || currentUser.uid === 'guest') {
                alert('Please sign in to add needs');
                return;
            }
            addNeedModal.style.display = 'flex';
        }
        
        // Close need modal
        function closeNeedModal() {
            addNeedModal.style.display = 'none';
            needForm.reset();
            document.getElementById('needStatusMessage').style.display = 'none';
        }
        
        // Add new need
        async function addNewNeed(e) {
            e.preventDefault();
            const needName = document.getElementById('needName').value;
            
            if (!needName) {
                showStatusMessage('needStatusMessage', 'Please enter a need', 'error');
                return;
            }
            
            try {
                const newNeed = {
                    name: needName,
                    frequency: document.getElementById('needFrequency').value,
                    description: document.getElementById('needDesc').value
                };
                
                userNeeds.push(newNeed);
                await db.collection('users').doc(currentUser.uid).update({
                    needs: firebase.firestore.FieldValue.arrayUnion(newNeed)
                });
                
                renderNeeds();
                showStatusMessage('needStatusMessage', 'Need added successfully!', 'success');
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    closeNeedModal();
                }, 2000);
            } catch (error) {
                console.error('Error adding need:', error);
                showStatusMessage('needStatusMessage', 'Failed to add need. Please try again.', 'error');
            }
        }
        
        // Render needs to UI
        function renderNeeds() {
            needsList.innerHTML = '';
            
            if (userNeeds.length === 0) {
                needsList.innerHTML = '<p>No needs added yet</p>';
                return;
            }
            
            userNeeds.forEach((need, index) => {
                const needItem = document.createElement('div');
                needItem.className = 'need-item';
                needItem.innerHTML = `
                    <span>${need.name} (${need.frequency})</span>
                    <div class="need-actions">
                        <button class="edit-btn" onclick="editNeed(${index})"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteNeed(${index})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                needsList.appendChild(needItem);
            });
        }
        
        // Delete need
        async function deleteNeed(index) {
            if (!currentUser || currentUser.uid === 'guest') return;
            
            if (confirm('Are you sure you want to delete this need?')) {
                try {
                    const needToDelete = userNeeds[index];
                    userNeeds.splice(index, 1);
                    
                    await db.collection('users').doc(currentUser.uid).update({
                        needs: firebase.firestore.FieldValue.arrayRemove(needToDelete)
                    });
                    
                    renderNeeds();
                } catch (error) {
                    console.error('Error deleting need:', error);
                    alert('Failed to delete need. Please try again.');
                }
            }
        }
        
        // Edit post
        function editPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            postContent.value = post.content;
            postCategory.value = post.category;
            modeToggle.checked = post.isHelpOffer;
            toggleHelpMode({target: modeToggle});
            
            document.querySelector('.create-post').scrollIntoView({ behavior: 'smooth' });
            alert('Post loaded for editing. Make your changes and click "Update Post"');
        }
        
        // Delete post
        async function deletePost(postId) {
            if (!currentUser || currentUser.uid === 'guest') return;
            
            if (confirm('Are you sure you want to delete this post?')) {
                try {
                    await db.collection('posts').doc(postId).delete();
                    document.getElementById(`post-${postId}`).remove();
                    alert('Post deleted successfully');
                } catch (error) {
                    console.error('Error deleting post:', error);
                    alert('Failed to delete post. Please try again.');
                }
            }
        }
        
        // Logout
        async function logout(e) {
            if (e) e.preventDefault();
            try {
                await auth.signOut();
                // Reset UI for guest
                currentUser = {
                    uid: 'guest',
                    displayName: 'Guest User',
                    email: 'guest@example.com',
                    photoURL: 'https://randomuser.me/api/portraits/lego/1.jpg'
                };
                userProfile = {};
                userSkills = [];
                userNeeds = [];
                posts = [];
                
                updateUserUI();
                renderSkills();
                renderNeeds();
                postsContainer.innerHTML = '';
                
                profileDropdown.classList.remove('active');
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }
        
        // Helper function to show status messages
        function showStatusMessage(elementId, message, type) {
            const element = typeof elementId === 'string' ? document.getElementById(elementId) : elementId;
            if (!element) return;
            
            element.textContent = message;
            element.className = 'status-message ' + type;
            element.style.display = 'block';
            
            // Clear message after 3 seconds
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }
        
        // Helper function to get time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            
            return "just now";
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === connectionModal) closeModal();
            if (e.target === profileModal) closeProfileModal();
            if (e.target === addSkillModal) closeSkillModal();
            if (e.target === addNeedModal) closeNeedModal();
        });


    // Current edit state variables
    let currentEditSkillIndex = null;
    let currentEditNeedIndex = null;

    // Initialize application
    function initApp() {
        // ... existing event listeners ...

        // Add these new listeners
        document.addEventListener('click', closeDropdowns);
        window.addEventListener('click', closeModalsOnOutsideClick);
    }

    // Close dropdowns when clicking elsewhere
    function closeDropdowns(e) {
        if (!e.target.closest('.user-profile') && profileDropdown.classList.contains('active')) {
            profileDropdown.classList.remove('active');
        }
    }

    // Close modals when clicking outside
    function closeModalsOnOutsideClick(e) {
        if (e.target === connectionModal) closeModal();
        if (e.target === profileModal) closeProfileModal();
        if (e.target === addSkillModal) closeSkillModal();
        if (e.target === addNeedModal) closeNeedModal();
    }

    // Load user profile from Firestore
    async function loadUserProfile() {
        // ... existing code ...
        
        if (userDoc.exists) {
            userProfile = userDoc.data();
            // Ensure arrays exist
            userSkills = userProfile.skills || [];
            userNeeds = userProfile.needs || [];
            
            updateUserUI();
            renderSkills();
            renderNeeds();
        }
        // ... rest of function ...
    }

    // Update UI with user data
    function updateUserUI() {
        // ... existing code ...
        
        // FIX: Handle skills properly
        currentUserSkills.textContent = userSkills.length > 0 ? 
            'Offering: ' + userSkills.slice(0, 3).map(skill => skill.name).join(', ') : 
            'Offering help';
    }

    // Save profile
    async function saveProfile(e) {
        e.preventDefault();
        
        // ... existing validation ...

        try {
            // Update userProfile object
            userProfile.name = document.getElementById('profileName').value;
            userProfile.bio = document.getElementById('profileBio').value;
            userProfile.location = document.getElementById('profileLocation').value;
            userProfile.status = document.getElementById('profileStatus').value;
            userProfile.skills = userSkills;
            userProfile.needs = userNeeds;
            
            await db.collection('users').doc(currentUser.uid).set(userProfile, { merge: true });
            // ... rest of function ...
        }
    }

    // Open skill modal for editing
    function openSkillModal(index = null) {
        if (!currentUser || currentUser.uid === 'guest') {
            alert('Please sign in to manage skills');
            return;
        }
        
        const modalTitle = document.querySelector('#addSkillModal h3');
        if (index !== null) {
            // Edit mode
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Skill';
            const skill = userSkills[index];
            document.getElementById('skillName').value = skill.name;
            document.getElementById('skillLevel').value = skill.level;
            document.getElementById('skillDesc').value = skill.description || '';
            currentEditSkillIndex = index;
        } else {
            // Add mode
            modalTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Add New Skill';
            document.getElementById('skillForm').reset();
            currentEditSkillIndex = null;
        }
        
        addSkillModal.style.display = 'flex';
    }

    // Add or update skill
    async function addNewSkill(e) {
        e.preventDefault();
        const skillName = document.getElementById('skillName').value;
        
        if (!skillName) {
            showStatusMessage('skillStatusMessage', 'Please enter a skill name', 'error');
            return;
        }
        
        try {
            const newSkill = {
                name: skillName,
                level: document.getElementById('skillLevel').value,
                description: document.getElementById('skillDesc').value
            };
            
            if (currentEditSkillIndex !== null) {
                // Update existing skill
                userSkills[currentEditSkillIndex] = newSkill;
            } else {
                // Add new skill
                userSkills.push(newSkill);
            }
            
            await db.collection('users').doc(currentUser.uid).update({
                skills: userSkills
            });
            
            renderSkills();
            showStatusMessage('skillStatusMessage', 
                currentEditSkillIndex !== null ? 'Skill updated successfully!' : 'Skill added successfully!', 
                'success');
            
            // Close modal after 2 seconds
            setTimeout(() => {
                closeSkillModal();
            }, 2000);
        } catch (error) {
            console.error('Error saving skill:', error);
            showStatusMessage('skillStatusMessage', 'Failed to save skill. Please try again.', 'error');
        }
    }

    // Edit skill
    function editSkill(index) {
        openSkillModal(index);
    }

    // Open need modal for editing
    function openNeedModal(index = null) {
        if (!currentUser || currentUser.uid === 'guest') {
            alert('Please sign in to manage needs');
            return;
        }
        
        const modalTitle = document.querySelector('#addNeedModal h3');
        if (index !== null) {
            // Edit mode
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Need';
            const need = userNeeds[index];
            document.getElementById('needName').value = need.name;
            document.getElementById('needFrequency').value = need.frequency;
            document.getElementById('needDesc').value = need.description || '';
            currentEditNeedIndex = index;
        } else {
            // Add mode
            modalTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Add New Need';
            document.getElementById('needForm').reset();
            currentEditNeedIndex = null;
        }
        
        addNeedModal.style.display = 'flex';
    }

    // Add or update need
    async function addNewNeed(e) {
        e.preventDefault();
        const needName = document.getElementById('needName').value;
        
        if (!needName) {
            showStatusMessage('needStatusMessage', 'Please enter a need', 'error');
            return;
        }
        
        try {
            const newNeed = {
                name: needName,
                frequency: document.getElementById('needFrequency').value,
                description: document.getElementById('needDesc').value
            };
            
            if (currentEditNeedIndex !== null) {
                // Update existing need
                userNeeds[currentEditNeedIndex] = newNeed;
            } else {
                // Add new need
                userNeeds.push(newNeed);
            }
            
            await db.collection('users').doc(currentUser.uid).update({
                needs: userNeeds
            });
            
            renderNeeds();
            showStatusMessage('needStatusMessage', 
                currentEditNeedIndex !== null ? 'Need updated successfully!' : 'Need added successfully!', 
                'success');
            
            // Close modal after 2 seconds
            setTimeout(() => {
                closeNeedModal();
            }, 2000);
        } catch (error) {
            console.error('Error saving need:', error);
            showStatusMessage('needStatusMessage', 'Failed to save need. Please try again.', 'error');
        }
    }

    // Edit need
    function editNeed(index) {
        openNeedModal(index);
    }

    // Close skill modal
    function closeSkillModal() {
        addSkillModal.style.display = 'none';
        document.getElementById('skillForm').reset();
        document.getElementById('skillStatusMessage').style.display = 'none';
        currentEditSkillIndex = null;
    }

    // Close need modal
    function closeNeedModal() {
        addNeedModal.style.display = 'none';
        document.getElementById('needForm').reset();
        document.getElementById('needStatusMessage').style.display = 'none';
        currentEditNeedIndex = null;
    }

    // Logout
    async function logout(e) {
        if (e) e.preventDefault();
        try {
            await auth.signOut();
            // Reset UI for guest
            currentUser = {
                uid: 'guest',
                displayName: 'Guest User',
                email: 'guest@example.com',
                photoURL: 'https://randomuser.me/api/portraits/lego/1.jpg'
            };
            userProfile = {
                skills: [],
                needs: []
            };
            userSkills = [];
            userNeeds = [];
            posts = [];
            
            updateUserUI();
            renderSkills();
            renderNeeds();
            postsContainer.innerHTML = '';
            
            profileDropdown.classList.remove('active');
            showStatusMessage(postStatusMessage, 'You have been logged out', 'success');
        } catch (error) {
            console.error('Error signing out:', error);
            showStatusMessage(postStatusMessage, 'Error logging out. Please try again.', 'error');
        }
    }

    // ... rest of existing code ...
</script>
    </script>
</body>
</html>
